# Introduction

This document describes the evaluation of several single sign-on solutions (SSO) for web applications. For the purpose of this document, SSO should refer to the process of a single-sign in action that provides access to mulitiple applications (typically related but not connected). Think of signing-in once in the morning and access a number of appliactions afterwards without authenticating again (e.g. entering username/password) until the session expires.

# Problem

While implementing a small web application in Python, I felt like I'm repeating myself when I wrote the code to authenticate users. So I started looking at SSO solutions that would allow me to authenticate users in my own applications and ideally also for other web applications. 

# Options

A Google search identified the following candiates:
* [JSON Web Tokens](https://jwt.io/)
* [Authentication Tickets](http://www.openfusion.com.au/labs/mod_auth_tkt/)

## JSON Web Tokens

Defined in RFC 7519, JSON web tokens (JWT) are a way to present claims (e.g. user identity between two parties). This could make them an ideal way to implement SSO. The SSO server can create an identity claim that can be sent to the web application. 

Once the JWT is obtained, it is presented to the web server in the authentication header of the HTTP requests. Therefore, any client using JWT needs to be able to set the HTTP authentication header appropriately. This is possible if the application is web based and all the requests to the web server. The web browser itself currently to not understand or implement JWT. 

It would be possible to set the JWT as a cookie in the web browser and get the client to send the cookie with the HTTP request. However, there is currently no support for Apache read the JWT from a cookie. Nginx has a commercial module that supports reading [JWT from a cookie](http://nginx.org/en/docs/http/ngx_http_auth_jwt_module.html). 

In summary, JWTs are a great solution for API based web application where the client can set the authorisation header in the HTTP requests. However, for legacy web applications (i.e. not Javascript based, or simple HTML sites) JWT are not simple to use.

## Authentication Tickets

Authentication tickets use, on an high-level, the same principle as JWTs. The authentication server creates a signed tickets, the application then uses the ticket to authentication against the application. The difference to JWTs is that the ticket is creates as cookie in the client's web browers. 

As the ticket is set as a cookie, not changes to the client is required. The client (i.e. the web browser) just works at it would normally.

There are the ususal restrictions with cookies. A cookie can only be set of one domain. For example, if the authentication server is sso.example.com, the web applications can only be other sub domains like server0.example.com but not server1.example.org.

The current implementation in Apache uses symmetric encryption to sign the ticket. Consequently, all systems need to share a common secret and if the secret is compromised on one system, the authentication for all web servers using the same secret is compromised. 

There is an alternative implementation that uses public keys (mod_auth_pubtkt)[https://neon1.net/mod_auth_pubtkt/] to sign the ticket. However, the implementation is not yet available in the standard packages of any distribution.



 

# Design

* use python tkt server
* 

The script runs every 10 seconds. For each run it collects the memory and network usage from LXD through API calls and the CPU usage through the corresponding cgroups. Once collected, the values are written to InfluxDB tagged with the host and container name.

# Implementation

The implementation of the Python scrip can be found here: [lxd2influx](https://github.com/m3ccanico/lxd2influx).

## InfluxDB

Go here for [instructions how to install InfluxDB](https://portal.influxdata.com/downloads).

Once InfluxDB was running, I only had to create a database for the analytics data:

```
influx
CREATE DATABASE lxd
```

Check if data is written:
```
USE lxd
SHOW SERIES
```

## Grafana

Go here for [instructions how to install Grafana](https://grafana.com/grafana/download).

The graf can be found here: [Grafana Graph JSON](https://github.com/m3ccanico/blog/blob/master/001/grafana-lxd.json)

